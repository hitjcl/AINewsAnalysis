<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®æ—¶è´¢ç»å¿«è®¯è§£è¯»</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --light: #f8f9fa;
            --grey: #95a5a6;
            --accent: #e74c3c;
            --success: #27ae60;
            --warning: #f1c40f;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.6;
            max-width: 100%;
            margin: 0 auto;
            padding: 1rem;
            background-color: var(--light);
        }

        .header {
            text-align: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--secondary);
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            color: white;
            padding: 1rem;
            border-radius: 8px;
        }

        .header h1 {
            font-size: 1.5rem;
            margin: 0;
        }

        .header p {
            color: var(--light);
            font-size: 0.9rem;
            margin-top: 0.2rem;
        }

        .news-card {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-left: 4px solid var(--secondary);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .news-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .news-time {
            color: var(--grey);
            font-size: 0.75rem;
            margin-bottom: 0.25rem;
            display: none; /* é»˜è®¤éšè—æ—¶é—´æˆ³ */
        }

        .news-title {
            color: var(--primary);
            font-weight: 600;
            margin: 0;
            font-size: 1rem;
        }

        .news-content {
            color: #444;
            margin: 0.5rem 0;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .ai-analysis {
            background: #f0f8ff;
            border-left: 2px solid var(--secondary);
            padding: 0.5rem;
            margin-top: 0.5rem;
            border-radius: 4px;
            color: #2c3e50;
            font-size: 0.85rem;
            position: relative;
        }

        .ai-analysis::before {
            content: "ğŸ’¡";
            position: absolute;
            left: -10px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--secondary);
            color: white;
            padding: 5px;
            border-radius: 50%;
            font-size: 0.8rem;
        }

        .error-message {
            color: var(--accent);
            padding: 1rem;
            text-align: center;
            background: #f8d7da;
            border-radius: 8px;
            border: 1px solid var(--accent);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 600px) {
            .header h1 {
                font-size: 1.2rem;
            }

            .header p {
                font-size: 0.8rem;
            }

            .news-title {
                font-size: 0.9rem;
            }

            .news-content {
                font-size: 0.8rem;
            }

            .ai-analysis {
                font-size: 0.75rem;
            }

            .news-time {
                display: block; /* åœ¨å°å±å¹•ä¸Šæ˜¾ç¤ºæ—¶é—´æˆ³ */
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>å®æ—¶è´¢ç»å¿«è®¯è§£è¯»</h1>
        <p>AIå³æ—¶åˆ†æ â€¢ æ¯60ç§’æ›´æ–°</p>
    </div>
    
    <div id="news-container"></div>

    <script>
        // å®‰å…¨æç¤ºï¼šå®é™…ç”Ÿäº§ç¯å¢ƒåº”å°†APIå¯†é’¥å­˜å‚¨åœ¨åç«¯
        const GLM_API_KEY = "6911cc967ea84b67b976839aa0c062d7.lq1ZnQ0gVN6wqvIr";
        const CORS_PROXY = 'https://api.allorigins.win/raw?url=';

        async function fetchNews() {
            const NEWS_API_URL = CORS_PROXY + encodeURIComponent(
                'https://api-one.wallstcn.com/apiv1/content/lives?channel=global-channel&limit=10'
            );

            try {
                const response = await fetch(NEWS_API_URL, {
                    headers: {
                        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
                        'Referer': 'https://wallstreetcn.com/'
                    }
                });
                
                if (!response.ok) throw new Error('è·å–æ–°é—»å¤±è´¥');
                const data = await response.json();

                return data.data.items.map(item => ({
                    time: new Date(item.display_time * 1000).toLocaleString('zh-CN'),
                    title: item.title || "æ— æ ‡é¢˜",
                    content: item.content_text || "æ— æ­£æ–‡å†…å®¹"
                }));

            } catch (error) {
                showError(`æ–°é—»åŠ è½½å¤±è´¥: ${error.message}`);
                return [];
            }
        }

        async function getAIAnalysis(title, content) {
            const messages = [
                {
                    role: "system",
                    content: "ä½œä¸ºä¸“ä¸šé‡‘èåˆ†æå¸ˆï¼Œè¯·ç”¨1å¥è¯è¯´æ˜ï¼š1) äº‹ä»¶æœ¬è´¨ 2) åˆ©å¥½/åˆ©ç©ºæ–¹å‘å’Œç›¸å…³å…¬å¸ï¼Œæ•°å­—è´§å¸ï¼Œå•†å“ç­‰èµ„äº§å’Œä¸Šä¸‹æ¸¸ä¾›åº”é“¾ 3) å½±å“å¼ºåº¦ï¼ˆå¼±/ä¸­/å¼ºï¼‰"
                },
                {
                    role: "user",
                    content: `æ ‡é¢˜ï¼š${title}\nå†…å®¹ï¼š${content}`
                }
            ];

            try {
                const response = await fetch('https://open.bigmodel.cn/api/paas/v4/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${GLM_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "glm-4-flash",
                        messages: messages,
                        temperature: 0.7
                    })
                });

                if (!response.ok) throw new Error(`APIè¯·æ±‚å¤±è´¥ï¼š${response.status}`);
                const data = await response.json();
                return data.choices[0]?.message?.content || "æš‚æ— åˆ†æç»“æœ";

            } catch (error) {
                console.error('AIåˆ†æé”™è¯¯:', error);
                return "AIåˆ†ææš‚æ—¶ä¸å¯ç”¨";
            }
        }

        function showError(message) {
            const container = document.getElementById('news-container');
            container.innerHTML = `
                <div class="error-message">
                    âš ï¸ ${message}<br>
                    <small>ï¼ˆå»ºè®®æ£€æŸ¥ç½‘ç»œè¿æ¥ååˆ·æ–°é¡µé¢ï¼‰</small>
                </div>
            `;
        }

        async function renderNews() {
            const container = document.getElementById('news-container');
            container.innerHTML = '';

            try {
                const newsList = await fetchNews();

                for (const news of newsList) {
                    const card = document.createElement('div');
                    card.className = 'news-card';
                    card.innerHTML = `
                        <div class="news-time">ğŸ“… ${news.time}</div>
                        <h3 class="news-title">${news.title}</h3>
                        <div class="news-content">${news.content}</div>
                        <div class="ai-analysis">ğŸ”„ åˆ†æä¸­...</div>
                    `;
                    container.appendChild(card);

                    // è·å–AIåˆ†æ
                    const analysis = await getAIAnalysis(news.title, news.content);
                    card.querySelector('.ai-analysis').innerHTML = `
                        <strong>AIè§£è¯»ï¼š</strong>${analysis}
                    `;
                }
            } catch (error) {
                showError(`æ•°æ®æ¸²æŸ“å¤±è´¥ï¼š${error.message}`);
            }
        }

        // åˆå§‹åŠ è½½
        renderNews();
        // å®šæ—¶åˆ·æ–°
        setInterval(renderNews, 60000);
    </script>
</body>
</html>